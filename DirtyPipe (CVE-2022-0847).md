## Description
A flaw was found in the way the "flags" member of the new pipe buffer structure was lacking proper initialization in copy_page_to_iter_pipe and push_pipe functions in the Linux kernel and could thus contain stale values. An unprivileged local user could use this flaw to write to pages in the page cache backed by read only files and as such escalate their privileges on the system.

## Affected Versions
Check your kernel version with `uname -r`
- Linux kernel versions > 5.8.
- The following Linux kernel versions are patched:
    - 5.16.11
    - 5.15.25
    - 5.10.102

[MITRE | CVE-2022-0847](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-0847)


## 1) Privilege Escalation via Arbitrary File Overwrite 
The following exploit has been modified to replace the root password with the password "piped" and will take a backup of the `/etc/passwd` file under `/tmp/passwd.bak`. Furthermore, the exploit will also provide you with an elevated root shell and will restore the original passwd file when done.
https://github.com/AlexisAhmed/CVE-2022-0847-DirtyPipe-Exploits/blob/main/exploit-1.c

## Exploitation - PoC

Complie the exploit `gcc exploit-1.c -o exploit-1` and run it `./exploit-1`.

## 2) Privilege Escalation via Hijacking SUID binaries
This exploit can be used to inject and overwrite data in read-only SUID process memory that run as root.

Find SUID set binaries with `find / -perm -4000 2>/dev/null`.

Use the following exploit: https://github.com/AlexisAhmed/CVE-2022-0847-DirtyPipe-Exploits/blob/main/exploit-2.c

## Exploitation - PoC
Complie the exploit `gcc exploit-2.c -o exploit-2` and run it `./exploit-2 /usr/bin/sudo`.

## References
- https://packetstormsecurity.com/files/166229/Dirty-Pipe-Linux-Privilege-Escalation.html
- https://github.com/AlexisAhmed/CVE-2022-0847-DirtyPipe-Exploits
- https://github.com/febinrev/dirtypipez-exploit
- https://github.com/basharkey/CVE-2022-0847-dirty-pipe-checker
